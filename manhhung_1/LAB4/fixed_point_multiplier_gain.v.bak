module fixed_point_multiplier_gain(
    input signed [15:0] int16,              // Đầu vào số nguyên 16-bit
    input [3:0] real4,                      // Đầu vào số thực 4-bit
    output signed [15:0] result             // Kết quả đầu ra là số nguyên 16-bit
);
    // Biến tạm để lưu giá trị số thực dưới dạng số nguyên mở rộng
    wire signed [15:0] real_extended;
    
    // Chuyển đổi số thực 4-bit thành số nguyên mở rộng 16-bit
    // Giả định real4[3] là bit dấu, real4[2] là phần nguyên, real4[1:0] là phần thập phân
    assign real_extended = {{12{real4[3]}}, real4[3], real4[2], real4[1:0], 2'b00};

    // Nhân số nguyên 16-bit với số thực đã mở rộng
    // Kết quả có thể cần được điều chỉnh nếu cần độ chính xác cao hơn
    assign result = (int16 * real_extended) >> 2;  // Dịch phải để điều chỉnh phép nhân với phần thập phân

endmodule
`timescale 1ns / 1ps

module tb_fixed_point_multiplier;

    // Định nghĩa các biến đầu vào và đầu ra
    reg signed [15:0] int16;
    reg [3:0] real4;
    wire signed [15:0] result;

    // Khởi tạo module cần kiểm tra
    fixed_point_multiplier uut (
        .int16(int16),
        .real4(real4),
        .result(result)
    );

    // Khởi tạo các giá trị đầu vào và quan sát đầu ra
    initial begin
        // Khởi tạo đầu vào
        int16 = 0;
        real4 = 4'b0000;
        #10; // Chờ 10 ns

        // Test case 1: Nhân với số dương nhỏ
        int16 = 16'd1000;     // Số nguyên 16-bit
        real4 = 4'b0101;      // Số thực 4-bit: +1.01 (định dạng dấu cố định)
        #10; // Chờ 10 ns

        // Test case 2: Nhân với số âm
        int16 = 16'd1000;
        real4 = 4'b1101;      // Số thực 4-bit: -1.01 (định dạng dấu cố định)
        #10; // Chờ 10 ns

        // Test case 3: Kiểm tra với số nguyên âm
        int16 = -16'd1000;
        real4 = 4'b0101;
        #10; // Chờ 10 ns

        // Test case 4: Kiểm tra với giá trị thực âm và nguyên âm
        int16 = -16'd1000;
        real4 = 4'b1101;
        #10; // Chờ 10 ns

        // Kết thúc simulation
        $finish;
    end

    // Theo dõi kết quả đầu ra
    initial begin
        $monitor("Time = %t, Input int16 = %d, Input real4 = %b, Output result = %d", 
                 $time, int16, real4, result);
    end

endmodule
